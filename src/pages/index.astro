---
import client from '../../tina/__generated__/client';
import SiteContentBridge from '../../tina/pages/SiteContentBridge.jsx';
import EditableHeaderHero from '../components/EditableHeaderHero.astro';
import EditableAutoPilotSection from '../components/EditableAutoPilotSection.astro';
import EditableQuickFixSection from '../components/EditableQuickFixSection.astro';
import EditableNoJargonSection from '../components/EditableNoJargonSection.astro';
import EditableRemainingSite from '../components/EditableRemainingSite.astro';
import assetManifest from '../generated/asset-manifest.json';

const siteContentQuery = await client.queries.site({ relativePath: 'home.json' });
const initialSiteContent = siteContentQuery.data.site;

const stylesheets = Array.isArray(assetManifest?.stylesheets) ? assetManifest.stylesheets : [];
const htmlClass = '__variable_e4fffa __variable_528cae __variable_3057fb';
const bodyClass = 'font-aspekta';

const businessName = initialSiteContent?.businessName || 'English Plumber';
const baseCity = initialSiteContent?.baseCity || 'Medemblik';
const whatsappNumber = initialSiteContent?.whatsappNumber || '+31 6 428 699 31';

const seoTitle =
  initialSiteContent?.seoTitle || `${businessName} | Plumbing & Heating in ${baseCity}`;
const seoDescription =
  initialSiteContent?.seoDescription ||
  `${businessName} is a friendly local plumber in ${baseCity}. Boiler servicing, radiator repairs, tap repairs, and general plumbing handyman work. WhatsApp ${whatsappNumber}.`;
---

<!doctype html>
<html lang="en" class={htmlClass}>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <meta name="format-detection" content="telephone=no" />
    <title>{seoTitle}</title>
    <meta name="description" content={seoDescription} />
    <meta property="og:title" content={seoTitle} />
    <meta property="og:description" content={seoDescription} />
    <meta property="og:type" content="website" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={seoTitle} />
    <meta name="twitter:description" content={seoDescription} />
    <link href="/favicon.ico" rel="icon" sizes="32x32" />

    {
      stylesheets.map((href) => (
        <link rel="stylesheet" href={`/${href}`} />
      ))
    }

    <style is:inline>
      .__tina-quick-editing-enabled [data-tina-field] {
        outline: 2px dashed rgba(254, 34, 56, 0.55);
        outline-offset: 2px;
      }

      .__tina-quick-editing-enabled [data-tina-field]:hover {
        outline: 2px dashed rgba(254, 34, 56, 0.95);
      }
    </style>

    <script is:inline>
      (() => {
        let lastWidth = window.innerWidth;

        const setVh = () => {
          const vh = window.innerHeight * 0.01;
          document.documentElement.style.setProperty('--vh', `${vh}px`);
        };

        const handleResize = () => {
          const currentWidth = window.innerWidth;
          if (currentWidth !== lastWidth) {
            lastWidth = currentWidth;
            setVh();
          }
        };

        setVh();
        window.addEventListener('resize', handleResize);
        window.addEventListener('orientationchange', setVh);
      })();
    </script>
  </head>

  <body class={bodyClass}>
    <EditableHeaderHero site={initialSiteContent} />
    <EditableAutoPilotSection site={initialSiteContent} />
    <EditableQuickFixSection site={initialSiteContent} />
    <EditableNoJargonSection site={initialSiteContent} />
    <EditableRemainingSite site={initialSiteContent} />
    <SiteContentBridge {...siteContentQuery} client:tina />
  </body>
</html>
